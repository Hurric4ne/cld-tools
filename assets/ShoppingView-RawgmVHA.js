import{h as A,o as d,a as u,i as B,n as V,j as I,c as v,b as l,w as N,e as F,F as y,d as T,f as O,g as w,t as S,k as D,l as L,m as q,p as C,v as E,q as J}from"./index-weF7i6PU.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U=A("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(i){this.selectedItems=i},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(i){this.startingLocation=i},clearStartingLocation(){this.startingLocation=""}}}),M={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(i){this.disabled||this.$emit("click",i)}}},P=["disabled"];function Q(i,t,p,e,f,h){return d(),u("button",{class:V(["themed-button",{"is-full-width":p.fullWidth}]),disabled:p.disabled,onClick:t[0]||(t[0]=(...r)=>h.handleClick&&h.handleClick(...r))},[B(i.$slots,"default")],10,P)}const j=k(M,[["render",Q]]),$={name:"ItemSearchList",components:{ThemedButton:j},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(i){const t=U(),p=I(""),e=I(""),f=I(""),h=I([]);let r=null;const s=v(()=>[...i.stations].sort((a,m)=>a.is_lagrange===m.is_lagrange?0:a.is_lagrange===0?-1:1)),n=v(()=>{const a=new Set;return i.items.filter(m=>m.price_buy===0||a.has(m.item_name)?!1:(a.add(m.item_name),!0))}),g=()=>{clearTimeout(r),r=setTimeout(()=>{f.value=e.value},1e3)},c=v(()=>f.value.trim()===""?n.value.filter(a=>h.value.some(m=>m.item_name===a.item_name)):n.value.filter(a=>a.item_name.toLowerCase().includes(f.value.toLowerCase())));return{userStore:t,sortedStations:s,startingLocation:p,searchQuery:e,selectedItems:h,filteredItems:c,handleInput:g,updateStoredItems:()=>{const a=n.value.filter(m=>h.value.includes(m.item_name));t.setSelectedItems(a),t.setStartingLocation(p.value)},resetStoredItems:()=>{h.value=[],e.value="",f.value="",t.clearSelectedItems(),t.clearStartingLocation()}}}},z=["disabled"],W={class:"item-list"},R=["value"],X={key:0},G={class:"button-container"};function H(i,t,p,e,f,h){const r=C("ThemedButton");return d(),u("div",{class:V(["item-search-list",{"is-disabled":!i.$props.items.length}])},[t[5]||(t[5]=l("h3",null,"Search through all available Items",-1)),N(l("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.searchQuery=s),onInput:t[1]||(t[1]=(...s)=>e.handleInput&&e.handleInput(...s)),placeholder:"Search items...",class:"search-bar",disabled:!i.$props.items.length},null,40,z),[[F,e.searchQuery]]),l("ul",W,[(d(!0),u(y,null,T(e.filteredItems,s=>(d(),u("li",{key:s.id,class:"item"},[l("label",null,[N(l("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=n=>e.selectedItems=n),value:s.item_name},null,8,R),[[O,e.selectedItems]]),w(" "+S(s.item_name),1)])]))),128)),e.filteredItems.length?D("",!0):(d(),u("p",X,"No items found."))]),l("div",G,[L(r,{disabled:!i.$props.items.length||!e.selectedItems.length,onClick:e.updateStoredItems},{default:q(()=>t[3]||(t[3]=[w(" Submit List ")])),_:1},8,["disabled","onClick"]),L(r,{disabled:!i.$props.items.length||!e.selectedItems.length,onClick:e.resetStoredItems},{default:q(()=>t[4]||(t[4]=[w(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const K=k($,[["render",H],["__scopeId","data-v-d9a1c05d"]]),Y={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(i){const t=U(),p=v(()=>{const s=t.selectedItems.map(n=>n.item_name);return i.items.filter(n=>s.includes(n.item_name)).filter(n=>n.price_buy>0)}),e=v(()=>{const s={};return p.value.forEach(n=>{s[n.id_terminal]||(s[n.id_terminal]=[]),s[n.id_terminal].push(n)}),Object.keys(s).map(n=>({id_terminal:n,items:s[n]}))});return{sortedTerminals:v(()=>{const s=new Set(p.value.map(c=>c.item_name)),n=[],g=new Set;if(t.startingLocation!==""){const c=e.value.find(_=>!!i.terminals.find(a=>{var b,x;const m=t.startingLocation.toLowerCase();return a.id===parseInt(_.id_terminal)&&(((b=a.space_station_name)==null?void 0:b.toLowerCase().includes(m))||((x=a.city_name)==null?void 0:x.toLowerCase().includes(m)))}));if(c){const _=c.items.filter(o=>s.has(o.item_name));_.length>0&&(n.push({id_terminal:c.id_terminal,items:_}),_.forEach(o=>s.delete(o.item_name)),g.add(c.id_terminal))}}for(;s.size>0;){let c=null,_=0;if(e.value.forEach(o=>{if(!g.has(o.id_terminal)){const a=o.items.filter(m=>s.has(m.item_name)).length;a>_&&(_=a,c=o)}}),c){const o=c.items.filter(a=>s.has(a.item_name));n.push({id_terminal:c.id_terminal,items:o}),o.forEach(a=>s.delete(a.item_name)),g.add(c.id_terminal)}else break}return n}),getTerminalName:s=>{const n=i.terminals.find(g=>g.id===parseInt(s));return n?n.name:"Unknown Terminal"},getTerminalStarSystem:s=>{const n=i.terminals.find(g=>g.id===parseInt(s));return n?n.star_system_name:"Unknown Star System"}}}},Z={class:"terminal-list"},ee={key:0},te={key:1,class:"no-items"};function se(i,t,p,e,f,h){return d(),u("div",Z,[t[0]||(t[0]=l("h3",null,"Automatic Shopping List",-1)),e.sortedTerminals.length?(d(),u("ul",ee,[(d(!0),u(y,null,T(e.sortedTerminals,(r,s)=>(d(),u("li",{class:"terminal",key:s},[l("strong",null,S(e.getTerminalStarSystem(r.id_terminal))+" | "+S(e.getTerminalName(r.id_terminal))+" ("+S(r.items.length)+" item"+S(r.items.length>1?"s":"")+") ",1),l("ul",null,[(d(!0),u(y,null,T(r.items,n=>(d(),u("li",{class:"item",key:n.item_name},S(n.item_name),1))),128))])]))),128))])):(d(),u("p",te,"No Items selected."))])}const ne=k(Y,[["render",se],["__scopeId","data-v-05ccf869"]]),ae={name:"ManualShoppingList",props:{items:{type:Array,required:!0},terminals:{type:Array,required:!0}},setup(i){const t=U(),p=v(()=>t.selectedItems),e=I(p.value.map(()=>"")),f=I(p.value.map(()=>"")),h=(c,_)=>{const o=i.items.filter(a=>a.item_name===c&&parseFloat(a.price_buy)>0).map(a=>{const m=i.terminals.find(b=>b.id===parseInt(a.id_terminal));return m&&(!_||m.planet_name===_)?m.name:null}).filter(a=>a!==null);return[...new Set(o)].sort((a,m)=>a.localeCompare(m))},r=c=>{const _=i.items.filter(o=>o.item_name===c).map(o=>{const a=i.terminals.find(m=>m.id===parseInt(o.id_terminal));return a?a.planet_name:null}).filter(o=>o!==null);return[...new Set(_)].sort((o,a)=>o.localeCompare(a))},s=(c,_)=>{if(!_||_==="Select Terminal")return 0;const o=i.terminals.find(m=>m.name===_);if(!o)return 0;const a=i.items.find(m=>m.item_name===c&&parseInt(m.id_terminal)===o.id);return a?parseInt(a.price_buy,10):0};return{selectedItems:p,selectedLocations:e,selectedTerminals:f,getTerminalsForItem:h,getLocationsForItem:r,getPriceForItem:s,getTotalCost:()=>p.value.reduce((c,_,o)=>c+s(_.item_name,f.value[o]),0),formatNumber:c=>c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}}},ie={class:"manual-shopping-list"},le={key:0},re=["onUpdate:modelValue"],oe=["value"],me=["onUpdate:modelValue"],ce=["value"],de={class:"total-row"},ue={class:"total-value"},_e={key:1,class:"no-items"};function pe(i,t,p,e,f,h){return d(),u("div",ie,[t[3]||(t[3]=l("h3",null,"Manual Shopping List",-1)),e.selectedItems.length?(d(),u("table",le,[t[2]||(t[2]=l("thead",null,[l("tr",null,[l("th",null,"Name"),l("th",null,"Location"),l("th",null,"Terminal"),l("th",null,"Price (aUEC)")])],-1)),l("tbody",null,[(d(!0),u(y,null,T(e.selectedItems,(r,s)=>(d(),u("tr",{key:s},[l("td",null,S(r.item_name),1),l("td",null,[N(l("select",{"onUpdate:modelValue":n=>e.selectedLocations[s]=n},[t[0]||(t[0]=l("option",{value:""},"All Locations",-1)),(d(!0),u(y,null,T(e.getLocationsForItem(r.item_name),(n,g)=>(d(),u("option",{key:g,value:n},S(n),9,oe))),128))],8,re),[[E,e.selectedLocations[s]]])]),l("td",null,[N(l("select",{"onUpdate:modelValue":n=>e.selectedTerminals[s]=n},[(d(!0),u(y,null,T(e.getTerminalsForItem(r.item_name,e.selectedLocations[s]),(n,g)=>(d(),u("option",{key:g,value:n},S(n),9,ce))),128))],8,me),[[E,e.selectedTerminals[s]]])]),l("td",null,S(e.formatNumber(e.getPriceForItem(r.item_name,e.selectedTerminals[s]))),1)]))),128)),l("tr",de,[t[1]||(t[1]=l("td",{colspan:"3",class:"total-label"},"Total",-1)),l("td",ue,S(e.formatNumber(e.getTotalCost()))+" aUEC",1)])])])):(d(),u("p",_e,"No Items selected."))])}const fe=k(ae,[["render",pe],["__scopeId","data-v-31de758d"]]),ge="/cld-tools/uex-logo.svg",he={components:{ItemSearchList:K,TerminalList:ne,UserTerminalList:fe},setup(){const i=I([]),t=I([]),p=I([]),e=I([]),f=I(!0),h=async()=>{const r={items:"https://api.uexcorp.space/2.0/items_prices_all",terminals:"https://api.uexcorp.space/2.0/terminals?type=item",stations:"https://api.uexcorp.space/2.0/space_stations?id_star_system=68",cities:"https://api.uexcorp.space/2.0/cities?id_star_system=68"};try{const s=async a=>(await(await fetch(a)).json()).data,[n,g,c,_]=await Promise.all([s(r.items),s(r.terminals),s(r.stations),s(r.cities)]);i.value=n,t.value=g,p.value=c,e.value=_,localStorage.removeItem("items"),localStorage.removeItem("terminals"),localStorage.removeItem("stations"),localStorage.removeItem("cities"),localStorage.removeItem("orbit_distances"),localStorage.setItem("items",JSON.stringify(n)),localStorage.setItem("terminals",JSON.stringify(g)),localStorage.setItem("stations",JSON.stringify(c)),localStorage.setItem("cities",JSON.stringify(_));const o=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",o.toString())}catch(s){console.error("Error fetching data:",s)}finally{f.value=!1}};return J(async()=>{const r=localStorage.getItem("dataExpiration");!r||Date.now()>Number(r)?await h():(i.value=JSON.parse(localStorage.getItem("items"))||[],t.value=JSON.parse(localStorage.getItem("terminals"))||[],p.value=JSON.parse(localStorage.getItem("stations"))||[],e.value=JSON.parse(localStorage.getItem("cities"))||[],f.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:f,items:i,terminals:t,stations:p,cities:e}}},Ie={key:0,class:"loader-overlay"},Se={key:1};function ve(i,t,p,e,f,h){const r=C("ItemSearchList"),s=C("UserTerminalList"),n=C("TerminalList");return d(),u(y,null,[l("div",null,[t[1]||(t[1]=l("h1",{class:"title"},"Shopping-List",-1)),e.isLoading?(d(),u("div",Ie,t[0]||(t[0]=[l("div",{class:"loader"},null,-1)]))):(d(),u("div",Se,[L(r,{stations:e.stations,cities:e.cities,items:e.items},null,8,["stations","cities","items"]),L(s,{terminals:e.terminals,items:e.items},null,8,["terminals","items"]),L(n,{terminals:e.terminals,items:e.items},null,8,["terminals","items"])]))]),t[2]||(t[2]=l("p",{class:"uex-api-badge"},[w("Powered by "),l("img",{class:"uex-logo",src:ge,alt:"UEX",draggable:"false"})],-1))],64)}const be=k(he,[["render",ve],["__scopeId","data-v-0af35dcd"]]);export{be as default};
