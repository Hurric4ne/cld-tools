import{d as q,o as r,c as o,r as E,n as B,a as S,b as y,e as f,w as N,v as V,F as v,f as b,g as O,h as U,i as L,j as J,k as x,l as A,m as C,t as I,p as M}from"./index-BIWSbon1.js";const D=q("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(n){this.selectedItems=n},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(n){this.startingLocation=n},clearStartingLocation(){this.startingLocation=""}}}),T=(n,t)=>{const l=n.__vccOpts||n;for(const[s,d]of t)l[s]=d;return l},Q={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(n){this.disabled||this.$emit("click",n)}}},$=["disabled"];function j(n,t,l,s,d,u){return r(),o("button",{class:B(["themed-button",{"is-full-width":l.fullWidth}]),disabled:l.disabled,onClick:t[0]||(t[0]=(...m)=>u.handleClick&&u.handleClick(...m))},[E(n.$slots,"default")],10,$)}const F=T(Q,[["render",j]]),z={name:"ItemSearchList",components:{ThemedButton:F},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(n){const t=D(),l=S(""),s=S(""),d=S(""),u=S([]);let m=null;const e=y(()=>[...n.stations].sort((i,p)=>i.is_lagrange===p.is_lagrange?0:i.is_lagrange===0?-1:1)),a=y(()=>{const i=new Set;return n.items.filter(p=>i.has(p.item_name)?!1:(i.add(p.item_name),!0))}),h=()=>{clearTimeout(m),m=setTimeout(()=>{d.value=s.value},1e3)},c=y(()=>d.value.trim()===""?a.value.filter(i=>u.value.some(p=>p.item_name===i.item_name)):a.value.filter(i=>i.item_name.toLowerCase().includes(d.value.toLowerCase())));return{userStore:t,sortedStations:e,startingLocation:l,searchQuery:s,selectedItems:u,filteredItems:c,handleInput:h,updateStoredItems:()=>{const i=a.value.filter(p=>u.value.includes(p.item_name));t.setSelectedItems(i),t.setStartingLocation(l.value)},resetStoredItems:()=>{u.value=[],s.value="",d.value="",t.clearSelectedItems(),t.clearStartingLocation()}}}},P=["disabled"],W={class:"item-list"},R=["value"],G={key:0},H={class:"button-container"},K=["value"],X=["value"];function Y(n,t,l,s,d,u){const m=x("ThemedButton");return r(),o("div",{class:B(["item-search-list",{"is-disabled":!n.$props.items.length}])},[t[7]||(t[7]=f("h3",null,"Search Items from filtered Categories",-1)),N(f("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.searchQuery=e),onInput:t[1]||(t[1]=(...e)=>s.handleInput&&s.handleInput(...e)),placeholder:"Search items...",class:"search-bar",disabled:!n.$props.items.length},null,40,P),[[V,s.searchQuery]]),f("ul",W,[(r(!0),o(v,null,b(s.filteredItems,e=>(r(),o("li",{key:e.id,class:"item"},[f("label",null,[N(f("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>s.selectedItems=a),value:e.item_name},null,8,R),[[A,s.selectedItems]]),C(" "+I(e.item_name),1)])]))),128)),s.filteredItems.length?O("",!0):(r(),o("p",G,"No items found."))]),f("div",H,[N(f("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.startingLocation=e),class:"starting-location"},[t[4]||(t[4]=f("option",{value:"",selected:"",disabled:""},"Starting Location (optional)",-1)),(r(!0),o(v,null,b(l.cities,e=>(r(),o("option",{key:e.id,value:e.name},I(e.name),9,K))),128)),(r(!0),o(v,null,b(s.sortedStations,e=>(r(),o(v,{key:e.id},[e.nickname!=="PO"&&e.nickname!=="INS Jericho"?(r(),o("option",{key:0,value:e.name},I(e.nickname),9,X)):O("",!0)],64))),128))],512),[[U,s.startingLocation]]),L(m,{disabled:!n.$props.items.length||!s.selectedItems.length,onClick:s.updateStoredItems},{default:J(()=>t[5]||(t[5]=[C(" Submit List ")])),_:1},8,["disabled","onClick"]),L(m,{disabled:!n.$props.items.length||!s.selectedItems.length,onClick:s.resetStoredItems},{default:J(()=>t[6]||(t[6]=[C(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const Z=T(z,[["render",Y],["__scopeId","data-v-42b3cf0f"]]),ee={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(n){const t=D(),l=y(()=>{const e=t.selectedItems.map(a=>a.item_name);return n.items.filter(a=>e.includes(a.item_name)).filter(a=>a.price_buy>0)}),s=y(()=>{const e={};return l.value.forEach(a=>{e[a.id_terminal]||(e[a.id_terminal]=[]),e[a.id_terminal].push(a)}),Object.keys(e).map(a=>({id_terminal:a,items:e[a]}))});return{sortedTerminals:y(()=>{const e=new Set(l.value.map(c=>c.item_name)),a=[],h=new Set;if(t.startingLocation!==""){const c=s.value.find(g=>!!n.terminals.find(i=>{var k,w;const p=t.startingLocation.toLowerCase();return i.id===parseInt(g.id_terminal)&&(((k=i.space_station_name)==null?void 0:k.toLowerCase().includes(p))||((w=i.city_name)==null?void 0:w.toLowerCase().includes(p)))}));if(c){const g=c.items.filter(_=>e.has(_.item_name));g.length>0&&(a.push({id_terminal:c.id_terminal,items:g}),g.forEach(_=>e.delete(_.item_name)),h.add(c.id_terminal))}}for(;e.size>0;){let c=null,g=0;if(s.value.forEach(_=>{if(!h.has(_.id_terminal)){const i=_.items.filter(p=>e.has(p.item_name)).length;i>g&&(g=i,c=_)}}),c){const _=c.items.filter(i=>e.has(i.item_name));a.push({id_terminal:c.id_terminal,items:_}),_.forEach(i=>e.delete(i.item_name)),h.add(c.id_terminal)}else break}return a}),getTerminalName:e=>{const a=n.terminals.find(h=>h.id===parseInt(e));return a?a.name:"Unknown Terminal"},getTerminalStarSystem:e=>{const a=n.terminals.find(h=>h.id===parseInt(e));return a?a.star_system_name:"Unknown Star System"}}}},te={class:"terminal-list"},se={key:0},ae={key:1};function ne(n,t,l,s,d,u){return r(),o("div",te,[t[0]||(t[0]=f("h3",null,"Terminal List",-1)),s.sortedTerminals.length?(r(),o("ul",se,[(r(!0),o(v,null,b(s.sortedTerminals,(m,e)=>(r(),o("li",{class:"terminal",key:e},[f("strong",null,I(s.getTerminalStarSystem(m.id_terminal))+" | "+I(s.getTerminalName(m.id_terminal))+" ("+I(m.items.length)+" item"+I(m.items.length>1?"s":"")+") ",1),f("ul",null,[(r(!0),o(v,null,b(m.items,a=>(r(),o("li",{class:"item",key:a.item_name},I(a.item_name),1))),128))])]))),128))])):(r(),o("p",ae,"No selected items found."))])}const ie=T(ee,[["render",ne],["__scopeId","data-v-da394645"]]),re={components:{ItemSearchList:Z,TerminalList:ie},setup(){const n=S([]),t=S([]),l=S([]),s=S([]),d=S([]),u=S(!0),m=async()=>{const e={items:"https://uexcorp.space/api/2.0/items_prices_all",terminals:"https://uexcorp.space/api/2.0/terminals?type=item",stations:"https://uexcorp.space/api/2.0/space_stations?id_star_system=68",cities:"https://uexcorp.space/api/2.0/cities?id_star_system=68",orbit_distances:"https://uexcorp.space/api/2.0/orbits_distances?id_star_system=68"};try{const a=async k=>(await(await fetch(k)).json()).data,[h,c,g,_,i]=await Promise.all([a(e.items),a(e.terminals),a(e.stations),a(e.cities),a(e.orbit_distances)]);n.value=h,t.value=c,l.value=g,s.value=_,d.value=i,localStorage.setItem("items",JSON.stringify(h)),localStorage.setItem("terminals",JSON.stringify(c)),localStorage.setItem("stations",JSON.stringify(g)),localStorage.setItem("cities",JSON.stringify(_)),localStorage.setItem("orbit_distances",JSON.stringify(i));const p=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",p.toString())}catch(a){console.error("Error fetching data:",a)}finally{u.value=!1}};return M(async()=>{const e=localStorage.getItem("dataExpiration");!e||Date.now()>Number(e)?await m():(n.value=JSON.parse(localStorage.getItem("items"))||[],t.value=JSON.parse(localStorage.getItem("terminals"))||[],l.value=JSON.parse(localStorage.getItem("stations"))||[],s.value=JSON.parse(localStorage.getItem("cities"))||[],d.value=JSON.parse(localStorage.getItem("orbit_distances"))||[],u.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:u,items:n,terminals:t,stations:l,cities:s,orbitDistances:d}}},oe={key:0,class:"loader-overlay"},le={key:1};function me(n,t,l,s,d,u){const m=x("ItemSearchList"),e=x("TerminalList");return r(),o("div",null,[t[1]||(t[1]=f("h1",{class:"title"},"Shopping-List",-1)),s.isLoading?(r(),o("div",oe,t[0]||(t[0]=[f("div",{class:"loader"},null,-1)]))):(r(),o("div",le,[L(m,{stations:s.stations,cities:s.cities,items:s.items},null,8,["stations","cities","items"]),L(e,{terminals:s.terminals,items:s.items},null,8,["terminals","items"])]))])}const ue=T(re,[["render",me],["__scopeId","data-v-9c586038"]]);export{ue as default};
