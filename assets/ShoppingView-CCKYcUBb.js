import{d as D,o as _,c as p,r as q,n as J,a as S,b as y,e as g,w as x,v as E,F as w,f as N,g as $,h as b,i as O,j as C,k as V,l as k,t as I,m as A}from"./index-B2KhJwYH.js";const B=D("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(i){this.selectedItems=i},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(i){this.startingLocation=i},clearStartingLocation(){this.startingLocation=""}}}),T=(i,s)=>{const r=i.__vccOpts||i;for(const[a,m]of s)r[a]=m;return r},U={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(i){this.disabled||this.$emit("click",i)}}},M=["disabled"];function Q(i,s,r,a,m,c){return _(),p("button",{class:J(["themed-button",{"is-full-width":r.fullWidth}]),disabled:r.disabled,onClick:s[0]||(s[0]=(...o)=>c.handleClick&&c.handleClick(...o))},[q(i.$slots,"default")],10,M)}const j=T(U,[["render",Q]]),F={name:"ItemSearchList",components:{ThemedButton:j},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(i){const s=B(),r=S(""),a=S(""),m=S(""),c=S([]);let o=null;const e=y(()=>[...i.stations].sort((n,u)=>n.is_lagrange===u.is_lagrange?0:n.is_lagrange===0?-1:1)),t=y(()=>{const n=new Set;return i.items.filter(u=>n.has(u.item_name)?!1:(n.add(u.item_name),!0))}),f=()=>{clearTimeout(o),o=setTimeout(()=>{m.value=a.value},1e3)},l=y(()=>m.value.trim()===""?t.value.filter(n=>c.value.some(u=>u.item_name===n.item_name)):t.value.filter(n=>n.item_name.toLowerCase().includes(m.value.toLowerCase())));return{userStore:s,sortedStations:e,startingLocation:r,searchQuery:a,selectedItems:c,filteredItems:l,handleInput:f,updateStoredItems:()=>{const n=t.value.filter(u=>c.value.includes(u.item_name));s.setSelectedItems(n),s.setStartingLocation(r.value)},resetStoredItems:()=>{c.value=[],a.value="",m.value="",s.clearSelectedItems(),s.clearStartingLocation()}}}},z=["disabled"],W={class:"item-list"},P=["value"],R={key:0},G={class:"button-container"};function H(i,s,r,a,m,c){const o=C("ThemedButton");return _(),p("div",{class:J(["item-search-list",{"is-disabled":!i.$props.items.length}])},[s[5]||(s[5]=g("h3",null,"Search Items from filtered Categories",-1)),x(g("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>a.searchQuery=e),onInput:s[1]||(s[1]=(...e)=>a.handleInput&&a.handleInput(...e)),placeholder:"Search items...",class:"search-bar",disabled:!i.$props.items.length},null,40,z),[[E,a.searchQuery]]),g("ul",W,[(_(!0),p(w,null,N(a.filteredItems,e=>(_(),p("li",{key:e.id,class:"item"},[g("label",null,[x(g("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>a.selectedItems=t),value:e.item_name},null,8,P),[[V,a.selectedItems]]),k(" "+I(e.item_name),1)])]))),128)),a.filteredItems.length?$("",!0):(_(),p("p",R,"No items found."))]),g("div",G,[b(o,{disabled:!i.$props.items.length||!a.selectedItems.length,onClick:a.updateStoredItems},{default:O(()=>s[3]||(s[3]=[k(" Submit List ")])),_:1},8,["disabled","onClick"]),b(o,{disabled:!i.$props.items.length||!a.selectedItems.length,onClick:a.resetStoredItems},{default:O(()=>s[4]||(s[4]=[k(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const K=T(F,[["render",H],["__scopeId","data-v-d2e3005b"]]),X={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(i){const s=B(),r=y(()=>{const e=s.selectedItems.map(t=>t.item_name);return i.items.filter(t=>e.includes(t.item_name)).filter(t=>t.price_buy>0)}),a=y(()=>{const e={};return r.value.forEach(t=>{e[t.id_terminal]||(e[t.id_terminal]=[]),e[t.id_terminal].push(t)}),Object.keys(e).map(t=>({id_terminal:t,items:e[t]}))});return{sortedTerminals:y(()=>{const e=new Set(r.value.map(l=>l.item_name)),t=[],f=new Set;if(s.startingLocation!==""){const l=a.value.find(h=>!!i.terminals.find(n=>{var v,L;const u=s.startingLocation.toLowerCase();return n.id===parseInt(h.id_terminal)&&(((v=n.space_station_name)==null?void 0:v.toLowerCase().includes(u))||((L=n.city_name)==null?void 0:L.toLowerCase().includes(u)))}));if(l){const h=l.items.filter(d=>e.has(d.item_name));h.length>0&&(t.push({id_terminal:l.id_terminal,items:h}),h.forEach(d=>e.delete(d.item_name)),f.add(l.id_terminal))}}for(;e.size>0;){let l=null,h=0;if(a.value.forEach(d=>{if(!f.has(d.id_terminal)){const n=d.items.filter(u=>e.has(u.item_name)).length;n>h&&(h=n,l=d)}}),l){const d=l.items.filter(n=>e.has(n.item_name));t.push({id_terminal:l.id_terminal,items:d}),d.forEach(n=>e.delete(n.item_name)),f.add(l.id_terminal)}else break}return t}),getTerminalName:e=>{const t=i.terminals.find(f=>f.id===parseInt(e));return t?t.name:"Unknown Terminal"},getTerminalStarSystem:e=>{const t=i.terminals.find(f=>f.id===parseInt(e));return t?t.star_system_name:"Unknown Star System"}}}},Y={class:"terminal-list"},Z={key:0},ee={key:1};function te(i,s,r,a,m,c){return _(),p("div",Y,[s[0]||(s[0]=g("h3",null,"Terminal List",-1)),a.sortedTerminals.length?(_(),p("ul",Z,[(_(!0),p(w,null,N(a.sortedTerminals,(o,e)=>(_(),p("li",{class:"terminal",key:e},[g("strong",null,I(a.getTerminalStarSystem(o.id_terminal))+" | "+I(a.getTerminalName(o.id_terminal))+" ("+I(o.items.length)+" item"+I(o.items.length>1?"s":"")+") ",1),g("ul",null,[(_(!0),p(w,null,N(o.items,t=>(_(),p("li",{class:"item",key:t.item_name},I(t.item_name),1))),128))])]))),128))])):(_(),p("p",ee,"No selected items found."))])}const se=T(X,[["render",te],["__scopeId","data-v-da394645"]]),ae={components:{ItemSearchList:K,TerminalList:se},setup(){const i=S([]),s=S([]),r=S([]),a=S([]),m=S([]),c=S(!0),o=async()=>{const e={items:"https://uexcorp.space/api/2.0/items_prices_all",terminals:"https://uexcorp.space/api/2.0/terminals?type=item",stations:"https://uexcorp.space/api/2.0/space_stations?id_star_system=68",cities:"https://uexcorp.space/api/2.0/cities?id_star_system=68",orbit_distances:"https://uexcorp.space/api/2.0/orbits_distances?id_star_system=68"};try{const t=async v=>(await(await fetch(v)).json()).data,[f,l,h,d,n]=await Promise.all([t(e.items),t(e.terminals),t(e.stations),t(e.cities),t(e.orbit_distances)]);i.value=f,s.value=l,r.value=h,a.value=d,m.value=n,localStorage.setItem("items",JSON.stringify(f)),localStorage.setItem("terminals",JSON.stringify(l)),localStorage.setItem("stations",JSON.stringify(h)),localStorage.setItem("cities",JSON.stringify(d)),localStorage.setItem("orbit_distances",JSON.stringify(n));const u=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",u.toString())}catch(t){console.error("Error fetching data:",t)}finally{c.value=!1}};return A(async()=>{const e=localStorage.getItem("dataExpiration");!e||Date.now()>Number(e)?await o():(i.value=JSON.parse(localStorage.getItem("items"))||[],s.value=JSON.parse(localStorage.getItem("terminals"))||[],r.value=JSON.parse(localStorage.getItem("stations"))||[],a.value=JSON.parse(localStorage.getItem("cities"))||[],m.value=JSON.parse(localStorage.getItem("orbit_distances"))||[],c.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:c,items:i,terminals:s,stations:r,cities:a,orbitDistances:m}}},ie={key:0,class:"loader-overlay"},ne={key:1};function re(i,s,r,a,m,c){const o=C("ItemSearchList"),e=C("TerminalList");return _(),p("div",null,[s[1]||(s[1]=g("h1",{class:"title"},"Shopping-List",-1)),a.isLoading?(_(),p("div",ie,s[0]||(s[0]=[g("div",{class:"loader"},null,-1)]))):(_(),p("div",ne,[b(o,{stations:a.stations,cities:a.cities,items:a.items},null,8,["stations","cities","items"]),b(e,{terminals:a.terminals,items:a.items},null,8,["terminals","items"])]))])}const me=T(ae,[["render",re],["__scopeId","data-v-9c586038"]]);export{me as default};
