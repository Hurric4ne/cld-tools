import{d as q,o as u,c as _,r as V,n as F,a as I,b as v,e as o,w as N,v as O,F as y,f as L,g as B,h as T,i as A,j as k,k as D,l as w,t as S,m as J,p as E,q as M}from"./index-CJYAsNXu.js";const U=q("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(a){this.selectedItems=a},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(a){this.startingLocation=a},clearStartingLocation(){this.startingLocation=""}}}),b=(a,s)=>{const p=a.__vccOpts||a;for(const[e,f]of s)p[e]=f;return p},P={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(a){this.disabled||this.$emit("click",a)}}},$=["disabled"];function Q(a,s,p,e,f,g){return u(),_("button",{class:F(["themed-button",{"is-full-width":p.fullWidth}]),disabled:p.disabled,onClick:s[0]||(s[0]=(...r)=>g.handleClick&&g.handleClick(...r))},[V(a.$slots,"default")],10,$)}const j=b(P,[["render",Q]]),z={name:"ItemSearchList",components:{ThemedButton:j},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(a){const s=U(),p=I(""),e=I(""),f=I(""),g=I([]);let r=null;const n=v(()=>[...a.stations].sort((d,h)=>d.is_lagrange===h.is_lagrange?0:d.is_lagrange===0?-1:1)),t=v(()=>{const d=new Set;return a.items.filter(h=>d.has(h.item_name)?!1:(d.add(h.item_name),!0))}),m=()=>{clearTimeout(r),r=setTimeout(()=>{f.value=e.value},1e3)},i=v(()=>f.value.trim()===""?t.value.filter(d=>g.value.some(h=>h.item_name===d.item_name)):t.value.filter(d=>d.item_name.toLowerCase().includes(f.value.toLowerCase())));return{userStore:s,sortedStations:n,startingLocation:p,searchQuery:e,selectedItems:g,filteredItems:i,handleInput:m,updateStoredItems:()=>{const d=t.value.filter(h=>g.value.includes(h.item_name));s.setSelectedItems(d),s.setStartingLocation(p.value)},resetStoredItems:()=>{g.value=[],e.value="",f.value="",s.clearSelectedItems(),s.clearStartingLocation()}}}},W=["disabled"],R={class:"item-list"},X=["value"],G={key:0},H={class:"button-container"};function K(a,s,p,e,f,g){const r=k("ThemedButton");return u(),_("div",{class:F(["item-search-list",{"is-disabled":!a.$props.items.length}])},[s[5]||(s[5]=o("h3",null,"Search through all available Items",-1)),N(o("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=n=>e.searchQuery=n),onInput:s[1]||(s[1]=(...n)=>e.handleInput&&e.handleInput(...n)),placeholder:"Search items...",class:"search-bar",disabled:!a.$props.items.length},null,40,W),[[O,e.searchQuery]]),o("ul",R,[(u(!0),_(y,null,L(e.filteredItems,n=>(u(),_("li",{key:n.id,class:"item"},[o("label",null,[N(o("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>e.selectedItems=t),value:n.item_name},null,8,X),[[D,e.selectedItems]]),w(" "+S(n.item_name),1)])]))),128)),e.filteredItems.length?B("",!0):(u(),_("p",G,"No items found."))]),o("div",H,[T(r,{disabled:!a.$props.items.length||!e.selectedItems.length,onClick:e.updateStoredItems},{default:A(()=>s[3]||(s[3]=[w(" Submit List ")])),_:1},8,["disabled","onClick"]),T(r,{disabled:!a.$props.items.length||!e.selectedItems.length,onClick:e.resetStoredItems},{default:A(()=>s[4]||(s[4]=[w(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const Y=b(z,[["render",K],["__scopeId","data-v-7be5f04b"]]),Z={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(a){const s=U(),p=v(()=>{const n=s.selectedItems.map(t=>t.item_name);return a.items.filter(t=>n.includes(t.item_name)).filter(t=>t.price_buy>0)}),e=v(()=>{const n={};return p.value.forEach(t=>{n[t.id_terminal]||(n[t.id_terminal]=[]),n[t.id_terminal].push(t)}),Object.keys(n).map(t=>({id_terminal:t,items:n[t]}))});return{sortedTerminals:v(()=>{const n=new Set(p.value.map(i=>i.item_name)),t=[],m=new Set;if(s.startingLocation!==""){const i=e.value.find(l=>!!a.terminals.find(d=>{var C,x;const h=s.startingLocation.toLowerCase();return d.id===parseInt(l.id_terminal)&&(((C=d.space_station_name)==null?void 0:C.toLowerCase().includes(h))||((x=d.city_name)==null?void 0:x.toLowerCase().includes(h)))}));if(i){const l=i.items.filter(c=>n.has(c.item_name));l.length>0&&(t.push({id_terminal:i.id_terminal,items:l}),l.forEach(c=>n.delete(c.item_name)),m.add(i.id_terminal))}}for(;n.size>0;){let i=null,l=0;if(e.value.forEach(c=>{if(!m.has(c.id_terminal)){const d=c.items.filter(h=>n.has(h.item_name)).length;d>l&&(l=d,i=c)}}),i){const c=i.items.filter(d=>n.has(d.item_name));t.push({id_terminal:i.id_terminal,items:c}),c.forEach(d=>n.delete(d.item_name)),m.add(i.id_terminal)}else break}return t}),getTerminalName:n=>{const t=a.terminals.find(m=>m.id===parseInt(n));return t?t.name:"Unknown Terminal"},getTerminalStarSystem:n=>{const t=a.terminals.find(m=>m.id===parseInt(n));return t?t.star_system_name:"Unknown Star System"}}}},ee={class:"terminal-list"},te={key:0},se={key:1,class:"no-items"};function ne(a,s,p,e,f,g){return u(),_("div",ee,[s[0]||(s[0]=o("h3",null,"Automatic Shopping List",-1)),e.sortedTerminals.length?(u(),_("ul",te,[(u(!0),_(y,null,L(e.sortedTerminals,(r,n)=>(u(),_("li",{class:"terminal",key:n},[o("strong",null,S(e.getTerminalStarSystem(r.id_terminal))+" | "+S(e.getTerminalName(r.id_terminal))+" ("+S(r.items.length)+" item"+S(r.items.length>1?"s":"")+") ",1),o("ul",null,[(u(!0),_(y,null,L(r.items,t=>(u(),_("li",{class:"item",key:t.item_name},S(t.item_name),1))),128))])]))),128))])):(u(),_("p",se,"No Items selected."))])}const ae=b(Z,[["render",ne],["__scopeId","data-v-05ccf869"]]),ie={name:"ManualShoppingList",props:{items:{type:Array,required:!0},terminals:{type:Array,required:!0}},setup(a){const s=U(),p=v(()=>s.selectedItems),e=I(p.value.map(()=>"")),f=I(p.value.map(()=>"Select Terminal"));return J(e,(t,m)=>{t.forEach((i,l)=>{i!==m[l]&&(f.value[l]="Select Terminal")})}),{selectedItems:p,selectedLocations:e,selectedTerminals:f,getTerminalsForItem:(t,m)=>{const i=a.items.filter(l=>l.item_name===t).map(l=>{const c=a.terminals.find(d=>d.id===parseInt(l.id_terminal));return c&&(!m||c.planet_name===m)?c.name:null}).filter(l=>l!==null);return[...new Set(i)].sort((l,c)=>l.localeCompare(c))},getLocationsForItem:t=>{const m=a.items.filter(i=>i.item_name===t).map(i=>{const l=a.terminals.find(c=>c.id===parseInt(i.id_terminal));return l?l.planet_name:null}).filter(i=>i!==null);return[...new Set(m)].sort((i,l)=>i.localeCompare(l))},getPriceForItem:(t,m)=>{if(!m||m==="Select Terminal")return"N/A";const i=a.terminals.find(c=>c.name===m);if(!i)return"N/A";const l=a.items.find(c=>c.item_name===t&&parseInt(c.id_terminal)===i.id);return l?l.price_buy:"N/A"}}}},le={class:"manual-shopping-list"},re={key:0},oe=["onUpdate:modelValue"],me=["value"],ce=["onUpdate:modelValue"],de=["value"],ue={key:1,class:"no-items"};function _e(a,s,p,e,f,g){return u(),_("div",le,[s[2]||(s[2]=o("h3",null,"Manual Shopping List",-1)),e.selectedItems.length?(u(),_("table",re,[s[1]||(s[1]=o("thead",null,[o("tr",null,[o("th",null,"Name"),o("th",null,"Location"),o("th",null,"Terminal"),o("th",null,"Price (aUEC)")])],-1)),o("tbody",null,[(u(!0),_(y,null,L(e.selectedItems,(r,n)=>(u(),_("tr",{key:n},[o("td",null,S(r.item_name),1),o("td",null,[N(o("select",{"onUpdate:modelValue":t=>e.selectedLocations[n]=t},[s[0]||(s[0]=o("option",{value:""},"All Locations",-1)),(u(!0),_(y,null,L(e.getLocationsForItem(r.item_name),(t,m)=>(u(),_("option",{key:m,value:t},S(t),9,me))),128))],8,oe),[[E,e.selectedLocations[n]]])]),o("td",null,[N(o("select",{"onUpdate:modelValue":t=>e.selectedTerminals[n]=t},[(u(!0),_(y,null,L(e.getTerminalsForItem(r.item_name,e.selectedLocations[n]),(t,m)=>(u(),_("option",{key:m,value:t},S(t),9,de))),128))],8,ce),[[E,e.selectedTerminals[n]]])]),o("td",null,S(e.getPriceForItem(r.item_name,e.selectedTerminals[n]))+" aUEC ",1)]))),128))])])):(u(),_("p",ue,"No Items selected."))])}const pe=b(ie,[["render",_e],["__scopeId","data-v-82b93333"]]),fe="/cld-tools/uex-logo.svg",ge={components:{ItemSearchList:Y,TerminalList:ae,UserTerminalList:pe},setup(){const a=I([]),s=I([]),p=I([]),e=I([]),f=I(!0),g=async()=>{const r={items:"https://uexcorp.space/api/2.0/items_prices_all",terminals:"https://uexcorp.space/api/2.0/terminals?type=item",stations:"https://uexcorp.space/api/2.0/space_stations?id_star_system=68",cities:"https://uexcorp.space/api/2.0/cities?id_star_system=68"};try{const n=async d=>(await(await fetch(d)).json()).data,[t,m,i,l]=await Promise.all([n(r.items),n(r.terminals),n(r.stations),n(r.cities)]);a.value=t,s.value=m,p.value=i,e.value=l,localStorage.removeItem("items"),localStorage.removeItem("terminals"),localStorage.removeItem("stations"),localStorage.removeItem("cities"),localStorage.removeItem("orbit_distances"),localStorage.setItem("items",JSON.stringify(t)),localStorage.setItem("terminals",JSON.stringify(m)),localStorage.setItem("stations",JSON.stringify(i)),localStorage.setItem("cities",JSON.stringify(l));const c=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",c.toString())}catch(n){console.error("Error fetching data:",n)}finally{f.value=!1}};return M(async()=>{const r=localStorage.getItem("dataExpiration");!r||Date.now()>Number(r)?await g():(a.value=JSON.parse(localStorage.getItem("items"))||[],s.value=JSON.parse(localStorage.getItem("terminals"))||[],p.value=JSON.parse(localStorage.getItem("stations"))||[],e.value=JSON.parse(localStorage.getItem("cities"))||[],f.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:f,items:a,terminals:s,stations:p,cities:e}}},he={key:0,class:"loader-overlay"},Ie={key:1};function Se(a,s,p,e,f,g){const r=k("ItemSearchList"),n=k("UserTerminalList"),t=k("TerminalList");return u(),_(y,null,[o("div",null,[s[1]||(s[1]=o("h1",{class:"title"},"Shopping-List",-1)),e.isLoading?(u(),_("div",he,s[0]||(s[0]=[o("div",{class:"loader"},null,-1)]))):(u(),_("div",Ie,[T(r,{stations:e.stations,cities:e.cities,items:e.items},null,8,["stations","cities","items"]),T(n,{terminals:e.terminals,items:e.items},null,8,["terminals","items"]),T(t,{terminals:e.terminals,items:e.items},null,8,["terminals","items"])]))]),s[2]||(s[2]=o("p",{class:"uex-api-badge"},[w("Powered by "),o("img",{class:"uex-logo",src:fe,alt:"UEX",draggable:"false"})],-1))],64)}const ye=b(ge,[["render",Se],["__scopeId","data-v-bead04c3"]]);export{ye as default};
