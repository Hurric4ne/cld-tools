import{d as D,o as r,c as o,r as q,n as O,a as g,b as y,e as u,w as T,v as V,F as v,f as b,g as x,h as E,i as k,j as C,k as w,l as A,m as N,t as I,p as U}from"./index-CHp5K3h3.js";const J=D("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(n){this.selectedItems=n},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(n){this.startingLocation=n},clearStartingLocation(){this.startingLocation=""}}}),L=(n,t)=>{const l=n.__vccOpts||n;for(const[s,m]of t)l[s]=m;return l},M={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(n){this.disabled||this.$emit("click",n)}}},$=["disabled"];function Q(n,t,l,s,m,d){return r(),o("button",{class:O(["themed-button",{"is-full-width":l.fullWidth}]),disabled:l.disabled,onClick:t[0]||(t[0]=(...a)=>d.handleClick&&d.handleClick(...a))},[q(n.$slots,"default")],10,$)}const j=L(M,[["render",Q]]),F={name:"ItemSearchList",components:{ThemedButton:j},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(n){const t=J(),l=g(""),s=g(""),m=g(""),d=g([]);let a=null;const e=y(()=>[...n.stations].sort((c,h)=>c.is_lagrange===h.is_lagrange?0:c.is_lagrange===0?-1:1)),i=y(()=>{const c=new Set;return n.items.filter(h=>c.has(h.item_name)?!1:(c.add(h.item_name),!0))}),p=()=>{clearTimeout(a),a=setTimeout(()=>{m.value=s.value},1e3)},S=y(()=>m.value.trim()===""?i.value.filter(c=>d.value.some(h=>h.item_name===c.item_name)):i.value.filter(c=>c.item_name.toLowerCase().includes(m.value.toLowerCase())));return{userStore:t,sortedStations:e,startingLocation:l,searchQuery:s,selectedItems:d,filteredItems:S,handleInput:p,updateStoredItems:()=>{const c=i.value.filter(h=>d.value.includes(h.item_name));t.setSelectedItems(c),t.setStartingLocation(l.value)},resetStoredItems:()=>{d.value=[],s.value="",m.value="",t.clearSelectedItems(),t.clearStartingLocation()}}}},z=["disabled"],P={class:"item-list"},W=["value"],R={key:0},G={class:"button-container"},H=["value"],K=["value"];function X(n,t,l,s,m,d){const a=w("ThemedButton");return r(),o("div",{class:O(["item-search-list",{"is-disabled":!n.$props.items.length}])},[t[7]||(t[7]=u("h3",null,"Search Items from filtered Categories",-1)),T(u("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.searchQuery=e),onInput:t[1]||(t[1]=(...e)=>s.handleInput&&s.handleInput(...e)),placeholder:"Search items...",class:"search-bar",disabled:!n.$props.items.length},null,40,z),[[V,s.searchQuery]]),u("ul",P,[(r(!0),o(v,null,b(s.filteredItems,e=>(r(),o("li",{key:e.id,class:"item"},[u("label",null,[T(u("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=i=>s.selectedItems=i),value:e.item_name},null,8,W),[[A,s.selectedItems]]),N(" "+I(e.item_name),1)])]))),128)),s.filteredItems.length?x("",!0):(r(),o("p",R,"No items found."))]),u("div",G,[T(u("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.startingLocation=e),class:"starting-location"},[t[4]||(t[4]=u("option",{value:"",selected:"",disabled:""},"Select a Starting Location",-1)),(r(!0),o(v,null,b(l.cities,e=>(r(),o("option",{key:e.id,value:e.name},I(e.name),9,H))),128)),(r(!0),o(v,null,b(s.sortedStations,e=>(r(),o(v,{key:e.id},[e.nickname!=="PO"&&e.nickname!=="INS Jericho"?(r(),o("option",{key:0,value:e.name},I(e.nickname),9,K)):x("",!0)],64))),128))],512),[[E,s.startingLocation]]),k(a,{disabled:!n.$props.items.length||!s.selectedItems.length,onClick:s.updateStoredItems},{default:C(()=>t[5]||(t[5]=[N(" Submit List ")])),_:1},8,["disabled","onClick"]),k(a,{disabled:!n.$props.items.length||!s.selectedItems.length,onClick:s.resetStoredItems},{default:C(()=>t[6]||(t[6]=[N(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const Y=L(F,[["render",X],["__scopeId","data-v-1ebaf37c"]]),Z={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(n){const t=J(),l=y(()=>{const a=t.selectedItems.map(e=>e.item_name);return n.items.filter(e=>a.includes(e.item_name)).filter(e=>e.price_buy>0)}),s=y(()=>{const a={};return l.value.forEach(e=>{a[e.id_terminal]||(a[e.id_terminal]=[]),a[e.id_terminal].push(e)}),Object.keys(a).map(e=>({id_terminal:e,items:a[e]}))});return{sortedTerminals:y(()=>{const a=new Set(l.value.map(p=>p.item_name)),e=[],i=new Set;for(;a.size>0;){let p=null,S=0;if(s.value.forEach(_=>{if(!i.has(_.id_terminal)){const f=_.items.filter(c=>a.has(c.item_name)).length;f>S&&(S=f,p=_)}}),p){const _=p.items.filter(f=>a.has(f.item_name));e.push({id_terminal:p.id_terminal,items:_}),_.forEach(f=>a.delete(f.item_name)),i.add(p.id_terminal)}else break}return e}),getTerminalName:a=>{const e=n.terminals.find(i=>i.id===parseInt(a));return e?e.name:"Unknown Terminal"}}}},ee={class:"terminal-list"},te={key:0},se={key:1};function ae(n,t,l,s,m,d){return r(),o("div",ee,[t[0]||(t[0]=u("h3",null,"Terminal List",-1)),s.sortedTerminals.length?(r(),o("ul",te,[(r(!0),o(v,null,b(s.sortedTerminals,(a,e)=>(r(),o("li",{class:"terminal",key:e},[u("strong",null,I(s.getTerminalName(a.id_terminal))+" ("+I(a.items.length)+" item"+I(a.items.length>1?"s":"")+") ",1),u("ul",null,[(r(!0),o(v,null,b(a.items,i=>(r(),o("li",{class:"item",key:i.item_name},I(i.item_name),1))),128))])]))),128))])):(r(),o("p",se,"No selected items found."))])}const ne=L(Z,[["render",ae],["__scopeId","data-v-3e8fa62e"]]),ie={components:{ItemSearchList:Y,TerminalList:ne},setup(){const n=g([]),t=g([]),l=g([]),s=g([]),m=g([]),d=g(!0),a=async()=>{const e={items:"https://uexcorp.space/api/2.0/items_prices_all",terminals:"https://uexcorp.space/api/2.0/terminals?type=item",stations:"https://uexcorp.space/api/2.0/space_stations?id_star_system=68",cities:"https://uexcorp.space/api/2.0/cities?id_star_system=68",orbit_distances:"https://uexcorp.space/api/2.0/orbits_distances?id_star_system=68"};try{const i=async B=>(await(await fetch(B)).json()).data,[p,S,_,f,c]=await Promise.all([i(e.items),i(e.terminals),i(e.stations),i(e.cities),i(e.orbit_distances)]);n.value=p,t.value=S,l.value=_,s.value=f,m.value=c,localStorage.setItem("items",JSON.stringify(p)),localStorage.setItem("terminals",JSON.stringify(S)),localStorage.setItem("stations",JSON.stringify(_)),localStorage.setItem("cities",JSON.stringify(f)),localStorage.setItem("orbit_distances",JSON.stringify(c));const h=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",h.toString())}catch(i){console.error("Error fetching data:",i)}finally{d.value=!1}};return U(async()=>{const e=localStorage.getItem("dataExpiration");!e||Date.now()>Number(e)?await a():(n.value=JSON.parse(localStorage.getItem("items"))||[],t.value=JSON.parse(localStorage.getItem("terminals"))||[],l.value=JSON.parse(localStorage.getItem("stations"))||[],s.value=JSON.parse(localStorage.getItem("cities"))||[],m.value=JSON.parse(localStorage.getItem("orbit_distances"))||[],d.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:d,items:n,terminals:t,stations:l,cities:s,orbitDistances:m}}},re={key:0,class:"loader-overlay"},oe={key:1};function le(n,t,l,s,m,d){const a=w("ItemSearchList"),e=w("TerminalList");return r(),o("div",null,[t[1]||(t[1]=u("h1",{class:"title"},"Shopping-List",-1)),s.isLoading?(r(),o("div",re,t[0]||(t[0]=[u("div",{class:"loader"},null,-1)]))):(r(),o("div",oe,[k(a,{stations:s.stations,cities:s.cities,items:s.items},null,8,["stations","cities","items"]),k(e,{terminals:s.terminals,items:s.items},null,8,["terminals","items"])]))])}const ue=L(ie,[["render",le],["__scopeId","data-v-9c586038"]]);export{ue as default};
