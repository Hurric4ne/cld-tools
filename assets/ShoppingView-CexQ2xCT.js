import{d as A,o as u,c as _,r as B,n as q,a as I,b as v,e as i,w as N,v as F,F as y,f as T,g as O,h as L,i as E,j as w,k as D,l as C,t as S,m as V,p as J}from"./index-WKhk0mZ_.js";const U=A("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(l){this.selectedItems=l},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(l){this.startingLocation=l},clearStartingLocation(){this.startingLocation=""}}}),k=(l,t)=>{const d=l.__vccOpts||l;for(const[e,f]of t)d[e]=f;return d},M={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(l){this.disabled||this.$emit("click",l)}}},P=["disabled"];function Q(l,t,d,e,f,h){return u(),_("button",{class:q(["themed-button",{"is-full-width":d.fullWidth}]),disabled:d.disabled,onClick:t[0]||(t[0]=(...r)=>h.handleClick&&h.handleClick(...r))},[B(l.$slots,"default")],10,P)}const j=k(M,[["render",Q]]),$={name:"ItemSearchList",components:{ThemedButton:j},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(l){const t=U(),d=I(""),e=I(""),f=I(""),h=I([]);let r=null;const s=v(()=>[...l.stations].sort((a,m)=>a.is_lagrange===m.is_lagrange?0:a.is_lagrange===0?-1:1)),n=v(()=>{const a=new Set;return l.items.filter(m=>m.price_buy===0||a.has(m.item_name)?!1:(a.add(m.item_name),!0))}),g=()=>{clearTimeout(r),r=setTimeout(()=>{f.value=e.value},1e3)},c=v(()=>f.value.trim()===""?n.value.filter(a=>h.value.some(m=>m.item_name===a.item_name)):n.value.filter(a=>a.item_name.toLowerCase().includes(f.value.toLowerCase())));return{userStore:t,sortedStations:s,startingLocation:d,searchQuery:e,selectedItems:h,filteredItems:c,handleInput:g,updateStoredItems:()=>{const a=n.value.filter(m=>h.value.includes(m.item_name));t.setSelectedItems(a),t.setStartingLocation(d.value)},resetStoredItems:()=>{h.value=[],e.value="",f.value="",t.clearSelectedItems(),t.clearStartingLocation()}}}},z=["disabled"],W={class:"item-list"},R=["value"],X={key:0},G={class:"button-container"};function H(l,t,d,e,f,h){const r=w("ThemedButton");return u(),_("div",{class:q(["item-search-list",{"is-disabled":!l.$props.items.length}])},[t[5]||(t[5]=i("h3",null,"Search through all available Items",-1)),N(i("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.searchQuery=s),onInput:t[1]||(t[1]=(...s)=>e.handleInput&&e.handleInput(...s)),placeholder:"Search items...",class:"search-bar",disabled:!l.$props.items.length},null,40,z),[[F,e.searchQuery]]),i("ul",W,[(u(!0),_(y,null,T(e.filteredItems,s=>(u(),_("li",{key:s.id,class:"item"},[i("label",null,[N(i("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=n=>e.selectedItems=n),value:s.item_name},null,8,R),[[D,e.selectedItems]]),C(" "+S(s.item_name),1)])]))),128)),e.filteredItems.length?O("",!0):(u(),_("p",X,"No items found."))]),i("div",G,[L(r,{disabled:!l.$props.items.length||!e.selectedItems.length,onClick:e.updateStoredItems},{default:E(()=>t[3]||(t[3]=[C(" Submit List ")])),_:1},8,["disabled","onClick"]),L(r,{disabled:!l.$props.items.length||!e.selectedItems.length,onClick:e.resetStoredItems},{default:E(()=>t[4]||(t[4]=[C(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const K=k($,[["render",H],["__scopeId","data-v-d9a1c05d"]]),Y={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(l){const t=U(),d=v(()=>{const s=t.selectedItems.map(n=>n.item_name);return l.items.filter(n=>s.includes(n.item_name)).filter(n=>n.price_buy>0)}),e=v(()=>{const s={};return d.value.forEach(n=>{s[n.id_terminal]||(s[n.id_terminal]=[]),s[n.id_terminal].push(n)}),Object.keys(s).map(n=>({id_terminal:n,items:s[n]}))});return{sortedTerminals:v(()=>{const s=new Set(d.value.map(c=>c.item_name)),n=[],g=new Set;if(t.startingLocation!==""){const c=e.value.find(p=>!!l.terminals.find(a=>{var b,x;const m=t.startingLocation.toLowerCase();return a.id===parseInt(p.id_terminal)&&(((b=a.space_station_name)==null?void 0:b.toLowerCase().includes(m))||((x=a.city_name)==null?void 0:x.toLowerCase().includes(m)))}));if(c){const p=c.items.filter(o=>s.has(o.item_name));p.length>0&&(n.push({id_terminal:c.id_terminal,items:p}),p.forEach(o=>s.delete(o.item_name)),g.add(c.id_terminal))}}for(;s.size>0;){let c=null,p=0;if(e.value.forEach(o=>{if(!g.has(o.id_terminal)){const a=o.items.filter(m=>s.has(m.item_name)).length;a>p&&(p=a,c=o)}}),c){const o=c.items.filter(a=>s.has(a.item_name));n.push({id_terminal:c.id_terminal,items:o}),o.forEach(a=>s.delete(a.item_name)),g.add(c.id_terminal)}else break}return n}),getTerminalName:s=>{const n=l.terminals.find(g=>g.id===parseInt(s));return n?n.name:"Unknown Terminal"},getTerminalStarSystem:s=>{const n=l.terminals.find(g=>g.id===parseInt(s));return n?n.star_system_name:"Unknown Star System"}}}},Z={class:"terminal-list"},ee={key:0},te={key:1,class:"no-items"};function se(l,t,d,e,f,h){return u(),_("div",Z,[t[0]||(t[0]=i("h3",null,"Automatic Shopping List",-1)),e.sortedTerminals.length?(u(),_("ul",ee,[(u(!0),_(y,null,T(e.sortedTerminals,(r,s)=>(u(),_("li",{class:"terminal",key:s},[i("strong",null,S(e.getTerminalStarSystem(r.id_terminal))+" | "+S(e.getTerminalName(r.id_terminal))+" ("+S(r.items.length)+" item"+S(r.items.length>1?"s":"")+") ",1),i("ul",null,[(u(!0),_(y,null,T(r.items,n=>(u(),_("li",{class:"item",key:n.item_name},S(n.item_name),1))),128))])]))),128))])):(u(),_("p",te,"No Items selected."))])}const ne=k(Y,[["render",se],["__scopeId","data-v-05ccf869"]]),ae={name:"ManualShoppingList",props:{items:{type:Array,required:!0},terminals:{type:Array,required:!0}},setup(l){const t=U(),d=v(()=>t.selectedItems),e=I(d.value.map(()=>"")),f=I(d.value.map(()=>"")),h=(c,p)=>{const o=l.items.filter(a=>a.item_name===c&&parseFloat(a.price_buy)>0).map(a=>{const m=l.terminals.find(b=>b.id===parseInt(a.id_terminal));return m&&(!p||m.planet_name===p)?m.name:null}).filter(a=>a!==null);return[...new Set(o)].sort((a,m)=>a.localeCompare(m))},r=c=>{const p=l.items.filter(o=>o.item_name===c).map(o=>{const a=l.terminals.find(m=>m.id===parseInt(o.id_terminal));return a?a.planet_name:null}).filter(o=>o!==null);return[...new Set(p)].sort((o,a)=>o.localeCompare(a))},s=(c,p)=>{if(!p||p==="Select Terminal")return 0;const o=l.terminals.find(m=>m.name===p);if(!o)return 0;const a=l.items.find(m=>m.item_name===c&&parseInt(m.id_terminal)===o.id);return a?parseInt(a.price_buy,10):0};return{selectedItems:d,selectedLocations:e,selectedTerminals:f,getTerminalsForItem:h,getLocationsForItem:r,getPriceForItem:s,getTotalCost:()=>d.value.reduce((c,p,o)=>c+s(p.item_name,f.value[o]),0),formatNumber:c=>c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}}},le={class:"manual-shopping-list"},ie={key:0},re=["onUpdate:modelValue"],oe=["value"],me=["onUpdate:modelValue"],ce=["value"],de={class:"total-row"},ue={class:"total-value"},_e={key:1,class:"no-items"};function pe(l,t,d,e,f,h){return u(),_("div",le,[t[3]||(t[3]=i("h3",null,"Manual Shopping List",-1)),e.selectedItems.length?(u(),_("table",ie,[t[2]||(t[2]=i("thead",null,[i("tr",null,[i("th",null,"Name"),i("th",null,"Location"),i("th",null,"Terminal"),i("th",null,"Price (aUEC)")])],-1)),i("tbody",null,[(u(!0),_(y,null,T(e.selectedItems,(r,s)=>(u(),_("tr",{key:s},[i("td",null,S(r.item_name),1),i("td",null,[N(i("select",{"onUpdate:modelValue":n=>e.selectedLocations[s]=n},[t[0]||(t[0]=i("option",{value:""},"All Locations",-1)),(u(!0),_(y,null,T(e.getLocationsForItem(r.item_name),(n,g)=>(u(),_("option",{key:g,value:n},S(n),9,oe))),128))],8,re),[[V,e.selectedLocations[s]]])]),i("td",null,[N(i("select",{"onUpdate:modelValue":n=>e.selectedTerminals[s]=n},[(u(!0),_(y,null,T(e.getTerminalsForItem(r.item_name,e.selectedLocations[s]),(n,g)=>(u(),_("option",{key:g,value:n},S(n),9,ce))),128))],8,me),[[V,e.selectedTerminals[s]]])]),i("td",null,S(e.formatNumber(e.getPriceForItem(r.item_name,e.selectedTerminals[s]))),1)]))),128)),i("tr",de,[t[1]||(t[1]=i("td",{colspan:"3",class:"total-label"},"Total",-1)),i("td",ue,S(e.formatNumber(e.getTotalCost()))+" aUEC",1)])])])):(u(),_("p",_e,"No Items selected."))])}const fe=k(ae,[["render",pe],["__scopeId","data-v-31de758d"]]),ge="/cld-tools/uex-logo.svg",he={components:{ItemSearchList:K,TerminalList:ne,UserTerminalList:fe},setup(){const l=I([]),t=I([]),d=I([]),e=I([]),f=I(!0),h=async()=>{const r={items:"https://uexcorp.space/api/2.0/items_prices_all",terminals:"https://uexcorp.space/api/2.0/terminals?type=item",stations:"https://uexcorp.space/api/2.0/space_stations?id_star_system=68",cities:"https://uexcorp.space/api/2.0/cities?id_star_system=68"};try{const s=async a=>(await(await fetch(a)).json()).data,[n,g,c,p]=await Promise.all([s(r.items),s(r.terminals),s(r.stations),s(r.cities)]);l.value=n,t.value=g,d.value=c,e.value=p,localStorage.removeItem("items"),localStorage.removeItem("terminals"),localStorage.removeItem("stations"),localStorage.removeItem("cities"),localStorage.removeItem("orbit_distances"),localStorage.setItem("items",JSON.stringify(n)),localStorage.setItem("terminals",JSON.stringify(g)),localStorage.setItem("stations",JSON.stringify(c)),localStorage.setItem("cities",JSON.stringify(p));const o=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",o.toString())}catch(s){console.error("Error fetching data:",s)}finally{f.value=!1}};return J(async()=>{const r=localStorage.getItem("dataExpiration");!r||Date.now()>Number(r)?await h():(l.value=JSON.parse(localStorage.getItem("items"))||[],t.value=JSON.parse(localStorage.getItem("terminals"))||[],d.value=JSON.parse(localStorage.getItem("stations"))||[],e.value=JSON.parse(localStorage.getItem("cities"))||[],f.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:f,items:l,terminals:t,stations:d,cities:e}}},Ie={key:0,class:"loader-overlay"},Se={key:1};function ve(l,t,d,e,f,h){const r=w("ItemSearchList"),s=w("UserTerminalList"),n=w("TerminalList");return u(),_(y,null,[i("div",null,[t[1]||(t[1]=i("h1",{class:"title"},"Shopping-List",-1)),e.isLoading?(u(),_("div",Ie,t[0]||(t[0]=[i("div",{class:"loader"},null,-1)]))):(u(),_("div",Se,[L(r,{stations:e.stations,cities:e.cities,items:e.items},null,8,["stations","cities","items"]),L(s,{terminals:e.terminals,items:e.items},null,8,["terminals","items"]),L(n,{terminals:e.terminals,items:e.items},null,8,["terminals","items"])]))]),t[2]||(t[2]=i("p",{class:"uex-api-badge"},[C("Powered by "),i("img",{class:"uex-logo",src:ge,alt:"UEX",draggable:"false"})],-1))],64)}const Te=k(he,[["render",ve],["__scopeId","data-v-03258790"]]);export{Te as default};
