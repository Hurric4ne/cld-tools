import{d as q,o,c as l,r as E,n as B,a as g,b,e as p,w as N,v as V,F as y,f as k,g as O,h as U,i as L,j as J,k as x,l as A,m as C,t as I,p as M}from"./index-1vhrfgyG.js";const D=q("userStore",{state:()=>({selectedItems:[],startingLocation:""}),actions:{setSelectedItems(n){this.selectedItems=n},clearSelectedItems(){this.selectedItems=[]},setStartingLocation(n){this.startingLocation=n},clearStartingLocation(){this.startingLocation=""}}}),T=(n,t)=>{const m=n.__vccOpts||n;for(const[s,u]of t)m[s]=u;return m},Q={name:"ThemedButton",props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],methods:{handleClick(n){this.disabled||this.$emit("click",n)}}},$=["disabled"];function j(n,t,m,s,u,_){return o(),l("button",{class:B(["themed-button",{"is-full-width":m.fullWidth}]),disabled:m.disabled,onClick:t[0]||(t[0]=(...c)=>_.handleClick&&_.handleClick(...c))},[E(n.$slots,"default")],10,$)}const F=T(Q,[["render",j]]),z={name:"ItemSearchList",components:{ThemedButton:F},props:{items:{type:Array,required:!0},stations:{type:Array,required:!0},cities:{type:Array,required:!0}},setup(n){const t=D(),m=g(""),s=g(""),u=g(""),_=g([]);let c=null;const e=b(()=>[...n.stations].sort((i,r)=>i.is_lagrange===r.is_lagrange?0:i.is_lagrange===0?-1:1)),a=b(()=>{const i=new Set;return n.items.filter(r=>i.has(r.item_name)?!1:(i.add(r.item_name),!0))}),f=()=>{clearTimeout(c),c=setTimeout(()=>{u.value=s.value},1e3)},S=b(()=>u.value.trim()===""?a.value.filter(i=>_.value.some(r=>r.item_name===i.item_name)):a.value.filter(i=>i.item_name.toLowerCase().includes(u.value.toLowerCase())));return{userStore:t,sortedStations:e,startingLocation:m,searchQuery:s,selectedItems:_,filteredItems:S,handleInput:f,updateStoredItems:()=>{const i=a.value.filter(r=>_.value.includes(r.item_name));t.setSelectedItems(i),t.setStartingLocation(m.value)},resetStoredItems:()=>{_.value=[],s.value="",u.value="",t.clearSelectedItems(),t.clearStartingLocation()}}}},P=["disabled"],W={class:"item-list"},R=["value"],G={key:0},H={class:"button-container"},K=["value"],X=["value"];function Y(n,t,m,s,u,_){const c=x("ThemedButton");return o(),l("div",{class:B(["item-search-list",{"is-disabled":!n.$props.items.length}])},[t[7]||(t[7]=p("h3",null,"Search Items from filtered Categories",-1)),N(p("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.searchQuery=e),onInput:t[1]||(t[1]=(...e)=>s.handleInput&&s.handleInput(...e)),placeholder:"Search items...",class:"search-bar",disabled:!n.$props.items.length},null,40,P),[[V,s.searchQuery]]),p("ul",W,[(o(!0),l(y,null,k(s.filteredItems,e=>(o(),l("li",{key:e.id,class:"item"},[p("label",null,[N(p("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>s.selectedItems=a),value:e.item_name},null,8,R),[[A,s.selectedItems]]),C(" "+I(e.item_name),1)])]))),128)),s.filteredItems.length?O("",!0):(o(),l("p",G,"No items found."))]),p("div",H,[N(p("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.startingLocation=e),class:"starting-location"},[t[4]||(t[4]=p("option",{value:"",selected:"",disabled:""},"Starting Location (optional)",-1)),(o(!0),l(y,null,k(m.cities,e=>(o(),l("option",{key:e.id,value:e.name},I(e.name),9,K))),128)),(o(!0),l(y,null,k(s.sortedStations,e=>(o(),l(y,{key:e.id},[e.nickname!=="PO"&&e.nickname!=="INS Jericho"?(o(),l("option",{key:0,value:e.name},I(e.nickname),9,X)):O("",!0)],64))),128))],512),[[U,s.startingLocation]]),L(c,{disabled:!n.$props.items.length||!s.selectedItems.length,onClick:s.updateStoredItems},{default:J(()=>t[5]||(t[5]=[C(" Submit List ")])),_:1},8,["disabled","onClick"]),L(c,{disabled:!n.$props.items.length||!s.selectedItems.length,onClick:s.resetStoredItems},{default:J(()=>t[6]||(t[6]=[C(" Reset List ")])),_:1},8,["disabled","onClick"])])],2)}const Z=T(z,[["render",Y],["__scopeId","data-v-42b3cf0f"]]),ee={name:"TerminalList",props:{terminals:{type:Array,required:!0},items:{type:Array,required:!0}},setup(n){const t=D(),m=b(()=>{const e=t.selectedItems.map(a=>a.item_name);return n.items.filter(a=>e.includes(a.item_name)).filter(a=>a.price_buy>0)}),s=b(()=>{const e={};return m.value.forEach(a=>{e[a.id_terminal]||(e[a.id_terminal]=[]),e[a.id_terminal].push(a)}),Object.keys(e).map(a=>({id_terminal:a,items:e[a]}))});return{sortedTerminals:b(()=>{const e=new Set(m.value.map(d=>d.item_name)),a=[],f=new Set,S=s.value.find(d=>!!n.terminals.find(i=>{var v,w;const r=t.startingLocation.toLowerCase();return i.id===parseInt(d.id_terminal)&&(((v=i.space_station_name)==null?void 0:v.toLowerCase().includes(r))||((w=i.city_name)==null?void 0:w.toLowerCase().includes(r)))}));if(S){const d=S.items.filter(h=>e.has(h.item_name));d.length>0&&(a.push({id_terminal:S.id_terminal,items:d}),d.forEach(h=>e.delete(h.item_name)),f.add(S.id_terminal))}for(;e.size>0;){let d=null,h=0;if(s.value.forEach(i=>{if(!f.has(i.id_terminal)){const r=i.items.filter(v=>e.has(v.item_name)).length;r>h&&(h=r,d=i)}}),d){const i=d.items.filter(r=>e.has(r.item_name));a.push({id_terminal:d.id_terminal,items:i}),i.forEach(r=>e.delete(r.item_name)),f.add(d.id_terminal)}else break}return a}),getTerminalName:e=>{const a=n.terminals.find(f=>f.id===parseInt(e));return a?a.name:"Unknown Terminal"},getTerminalStarSystem:e=>{const a=n.terminals.find(f=>f.id===parseInt(e));return a?a.star_system_name:"Unknown Star System"}}}},te={class:"terminal-list"},se={key:0},ae={key:1};function ne(n,t,m,s,u,_){return o(),l("div",te,[t[0]||(t[0]=p("h3",null,"Terminal List",-1)),s.sortedTerminals.length?(o(),l("ul",se,[(o(!0),l(y,null,k(s.sortedTerminals,(c,e)=>(o(),l("li",{class:"terminal",key:e},[p("strong",null,I(s.getTerminalStarSystem(c.id_terminal))+" | "+I(s.getTerminalName(c.id_terminal))+" ("+I(c.items.length)+" item"+I(c.items.length>1?"s":"")+") ",1),p("ul",null,[(o(!0),l(y,null,k(c.items,a=>(o(),l("li",{class:"item",key:a.item_name},I(a.item_name),1))),128))])]))),128))])):(o(),l("p",ae,"No selected items found."))])}const ie=T(ee,[["render",ne],["__scopeId","data-v-bc850397"]]),re={components:{ItemSearchList:Z,TerminalList:ie},setup(){const n=g([]),t=g([]),m=g([]),s=g([]),u=g([]),_=g(!0),c=async()=>{const e={items:"https://uexcorp.space/api/2.0/items_prices_all",terminals:"https://uexcorp.space/api/2.0/terminals?type=item",stations:"https://uexcorp.space/api/2.0/space_stations?id_star_system=68",cities:"https://uexcorp.space/api/2.0/cities?id_star_system=68",orbit_distances:"https://uexcorp.space/api/2.0/orbits_distances?id_star_system=68"};try{const a=async v=>(await(await fetch(v)).json()).data,[f,S,d,h,i]=await Promise.all([a(e.items),a(e.terminals),a(e.stations),a(e.cities),a(e.orbit_distances)]);n.value=f,t.value=S,m.value=d,s.value=h,u.value=i,localStorage.setItem("items",JSON.stringify(f)),localStorage.setItem("terminals",JSON.stringify(S)),localStorage.setItem("stations",JSON.stringify(d)),localStorage.setItem("cities",JSON.stringify(h)),localStorage.setItem("orbit_distances",JSON.stringify(i));const r=Date.now()+24*60*60*1e3;localStorage.setItem("dataExpiration",r.toString())}catch(a){console.error("Error fetching data:",a)}finally{_.value=!1}};return M(async()=>{const e=localStorage.getItem("dataExpiration");!e||Date.now()>Number(e)?await c():(n.value=JSON.parse(localStorage.getItem("items"))||[],t.value=JSON.parse(localStorage.getItem("terminals"))||[],m.value=JSON.parse(localStorage.getItem("stations"))||[],s.value=JSON.parse(localStorage.getItem("cities"))||[],u.value=JSON.parse(localStorage.getItem("orbit_distances"))||[],_.value=!1,console.log("Data loaded from localStorage"))}),{isLoading:_,items:n,terminals:t,stations:m,cities:s,orbitDistances:u}}},oe={key:0,class:"loader-overlay"},le={key:1};function me(n,t,m,s,u,_){const c=x("ItemSearchList"),e=x("TerminalList");return o(),l("div",null,[t[1]||(t[1]=p("h1",{class:"title"},"Shopping-List",-1)),s.isLoading?(o(),l("div",oe,t[0]||(t[0]=[p("div",{class:"loader"},null,-1)]))):(o(),l("div",le,[L(c,{stations:s.stations,cities:s.cities,items:s.items},null,8,["stations","cities","items"]),L(e,{terminals:s.terminals,items:s.items},null,8,["terminals","items"])]))])}const ue=T(re,[["render",me],["__scopeId","data-v-9c586038"]]);export{ue as default};
